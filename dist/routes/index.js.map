{"version":3,"sources":["../../Finance_api/routes/index.js"],"names":["router","express","Router","Date","prototype","getWeek","dt","getFullYear","Math","ceil","getDay","use","req","res","next","locals","success_msg","flash","error_msg","error","user","Expenses","find","id","populate","sort","createdAt","userExpenses","aggregate","$match","mongoose","Types","ObjectId","$group","tota","year","toString","$sum","week","month","getMonth","checkLoggedIn","isAuthenticated","redirect","get","render","auth","logout","module","exports"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA,IAAMA,MAAM,GAAGC,oBAAQC,MAAR,EAAf;;AAEAC,IAAI,CAACC,SAAL,CAAeC,OAAf,GAAyB,YAAY;AACjC,MAAIC,EAAE,GAAG,IAAIH,IAAJ,CAAS,KAAKI,WAAL,EAAT,EAA6B,CAA7B,EAAgC,CAAhC,CAAT;AACA,SAAOC,IAAI,CAACC,IAAL,CAAU,CAAE,CAAC,OAAOH,EAAR,IAAc,QAAf,GAA2BA,EAAE,CAACI,MAAH,EAA3B,GAAyC,CAA1C,IAA+C,CAAzD,CAAP;AACH,CAHD;;AAKAV,MAAM,CAACW,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAW,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AACPD,YAAAA,GAAG,CAACE,MAAJ,CAAWC,WAAX,GAAyBJ,GAAG,CAACK,KAAJ,CAAU,aAAV,CAAzB;AACAJ,YAAAA,GAAG,CAACE,MAAJ,CAAWG,SAAX,GAAuBN,GAAG,CAACK,KAAJ,CAAU,WAAV,CAAvB;AACAJ,YAAAA,GAAG,CAACE,MAAJ,CAAWI,KAAX,GAAmBP,GAAG,CAACK,KAAJ,CAAU,OAAV,CAAnB;AACAJ,YAAAA,GAAG,CAACE,MAAJ,CAAWK,IAAX,GAAkBR,GAAG,CAACQ,IAAJ,IAAY,IAA9B;;AAJO,kBAKmB,OAAQR,GAAG,CAACQ,IAAZ,IAAqB,WALxC;AAAA;AAAA;AAAA;;AAAA,0BAKsD,IALtD;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAKmEC,qBAASC,IAAT,CAAc;AAAEF,cAAAA,IAAI,EAAER,GAAG,CAACQ,IAAJ,CAASG;AAAjB,aAAd,EAAqCC,QAArC,CAA8C,MAA9C,EAAsDC,IAAtD,CAA2D;AAAEC,cAAAA,SAAS,EAAE,CAAC;AAAd,aAA3D,CALnE;;AAAA;AAAA;;AAAA;AAKPb,YAAAA,GAAG,CAACE,MAAJ,CAAWY,YALJ;;AAAA,kBAMW,OAAOf,GAAG,CAACQ,IAAX,IAAmB,WAN9B;AAAA;AAAA;AAAA;;AAAA,0BAM4C,IAN5C;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAMyDC,qBAASO,SAAT,CAAmB,CAC/E;AACIC,cAAAA,MAAM,EAAE;AACJT,gBAAAA,IAAI,EAAEU,qBAASC,KAAT,CAAeC,QAAf,CAAwBpB,GAAG,CAACQ,IAAJ,CAASG,EAAjC;AADF;AADZ,aAD+E,EAM/E;AACIU,cAAAA,MAAM,EAAE;AACJ,uBAAO,IADH;AAEJ,0BAAU;AACN,0BAAQ;AADF;AAFN;AADZ,aAN+E,CAAnB,CANzD;;AAAA;AAAA;;AAAA;AAMPpB,YAAAA,GAAG,CAACE,MAAJ,CAAWmB,IANJ;;AAAA,kBAqBW,OAAOtB,GAAG,CAACQ,IAAX,IAAmB,WArB9B;AAAA;AAAA;AAAA;;AAAA,0BAqB4C,IArB5C;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAqByDC,qBAASO,SAAT,CAAmB,CAC/E;AACIC,cAAAA,MAAM,EAAE;AACJT,gBAAAA,IAAI,EAAEU,qBAASC,KAAT,CAAeC,QAAf,CAAwBpB,GAAG,CAACQ,IAAJ,CAASG,EAAjC,CADF;AAEJY,gBAAAA,IAAI,EAAE,IAAIhC,IAAJ,GAAWI,WAAX,GAAyB6B,QAAzB;AAFF;AADZ,aAD+E,EAO/E;AACIH,cAAAA,MAAM,EAAE;AACJ,uBAAO,IADH;AAEJ,0BAAU;AACNI,kBAAAA,IAAI,EAAE;AADA;AAFN;AADZ,aAP+E,CAAnB,CArBzD;;AAAA;AAAA;;AAAA;AAqBPxB,YAAAA,GAAG,CAACE,MAAJ,CAAWoB,IArBJ;;AAAA,kBAqCW,OAAOvB,GAAG,CAACQ,IAAX,IAAmB,WArC9B;AAAA;AAAA;AAAA;;AAAA,0BAqC4C,IArC5C;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAqCyDC,qBAASO,SAAT,CAAmB,CAC/E;AACIC,cAAAA,MAAM,EAAE;AACJT,gBAAAA,IAAI,EAAEU,qBAASC,KAAT,CAAeC,QAAf,CAAwBpB,GAAG,CAACQ,IAAJ,CAASG,EAAjC,CADF;AAEJe,gBAAAA,IAAI,EAAE,IAAInC,IAAJ,GAAWE,OAAX,GAAqB+B,QAArB;AAFF;AADZ,aAD+E,EAO/E;AACIH,cAAAA,MAAM,EAAE;AACJ,uBAAO,IADH;AAEJ,0BAAU;AACNI,kBAAAA,IAAI,EAAE;AADA;AAFN;AADZ,aAP+E,CAAnB,CArCzD;;AAAA;AAAA;;AAAA;AAqCPxB,YAAAA,GAAG,CAACE,MAAJ,CAAWuB,IArCJ;;AAAA,kBAqDY,OAAO1B,GAAG,CAACQ,IAAX,IAAmB,WArD/B;AAAA;AAAA;AAAA;;AAAA,0BAqD6C,IArD7C;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAqD0DC,qBAASO,SAAT,CAAmB,CAChF;AACIC,cAAAA,MAAM,EAAE;AACJT,gBAAAA,IAAI,EAAEU,qBAASC,KAAT,CAAeC,QAAf,CAAwBpB,GAAG,CAACQ,IAAJ,CAASG,EAAjC,CADF;AAEJgB,gBAAAA,KAAK,EAAE,IAAIpC,IAAJ,GAAWqC,QAAX,GAAsBJ,QAAtB;AAFH;AADZ,aADgF,EAOhF;AACIH,cAAAA,MAAM,EAAE;AACJ,uBAAO,IADH;AAEJ,0BAAU;AACNI,kBAAAA,IAAI,EAAE;AADA;AAFN;AADZ,aAPgF,CAAnB,CArD1D;;AAAA;AAAA;;AAAA;AAqDPxB,YAAAA,GAAG,CAACE,MAAJ,CAAWwB,KArDJ;AAqEPzB,YAAAA,IAAI;;AArEG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAX;;AAAA;AAAA;AAAA;AAAA;;AAwEA,SAAS2B,aAAT,CAAuB7B,GAAvB,EAA4BC,GAA5B,EAAiCC,IAAjC,EAAuC;AACnC,MAAIF,GAAG,CAAC8B,eAAJ,EAAJ,EACI7B,GAAG,CAAC8B,QAAJ,CAAa,MAAb,EADJ,KAEK;AACD7B,IAAAA,IAAI;AACP;AACJ,C,CAED;;;AACAd,MAAM,CAAC4C,GAAP,CAAW,GAAX,EAAgB,UAAChC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAChC,MAAIF,GAAG,CAAC8B,eAAJ,EAAJ,EAA2B;AACvB7B,IAAAA,GAAG,CAAC8B,QAAJ,CAAa,OAAb;AACH,GAFD,MAEO;AACH9B,IAAAA,GAAG,CAACgC,MAAJ,CAAW,OAAX;AACH;AACJ,CAND;AAQA7C,MAAM,CAAC4C,GAAP,CAAW,SAAX,EAAsBH,aAAtB,EAAqC,UAAC7B,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACrDD,EAAAA,GAAG,CAACgC,MAAJ,CAAW,SAAX;AACH,CAFD;AAIA7C,MAAM,CAAC4C,GAAP,CAAW,MAAX,EAAmB,UAAChC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACnCD,EAAAA,GAAG,CAACgC,MAAJ,CAAW,KAAX;AACH,CAFD;AAIA7C,MAAM,CAAC4C,GAAP,CAAW,OAAX,EAAoBE,gBAApB,EAA0B,UAAClC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC1C;AACAD,EAAAA,GAAG,CAACgC,MAAJ,CAAW,MAAX;AACH,CAHD;AAKA7C,MAAM,CAAC4C,GAAP,CAAW,QAAX,EAAqB,UAAChC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACrCD,EAAAA,GAAG,CAACgC,MAAJ,CAAW,OAAX;AACH,CAFD;AAIA7C,MAAM,CAAC4C,GAAP,CAAW,UAAX,EAAuB,UAAChC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACvCF,EAAAA,GAAG,CAACmC,MAAJ;AACA,SAAOlC,GAAG,CAAC8B,QAAJ,CAAa,GAAb,CAAP;AACH,CAHD;AAKAK,MAAM,CAACC,OAAP,GAAiBjD,MAAjB","sourcesContent":["import express from 'express';\r\nimport auth from '../config/auth';\r\nimport flash from 'express-flash';\r\nimport mongoose from 'mongoose';\r\nimport Expenses from '../models/expenses';\r\nconst router = express.Router();\r\n\r\nDate.prototype.getWeek = function () {\r\n    var dt = new Date(this.getFullYear(), 0, 1);\r\n    return Math.ceil((((this - dt) / 86400000) + dt.getDay() + 1) / 7);\r\n};\r\n\r\nrouter.use(async (req, res, next) => {\r\n    res.locals.success_msg = req.flash(\"success_msg\");\r\n    res.locals.error_msg = req.flash(\"error_msg\");\r\n    res.locals.error = req.flash(\"error\");\r\n    res.locals.user = req.user || null;\r\n    res.locals.userExpenses = typeof (req.user) == 'undefined' ? null : await Expenses.find({ user: req.user.id }).populate('user').sort({ createdAt: -1 });\r\n    res.locals.tota = typeof req.user == 'undefined' ? null : await Expenses.aggregate([\r\n        {\r\n            $match: {\r\n                user: mongoose.Types.ObjectId(req.user.id)\r\n            }\r\n        },\r\n        {\r\n            $group: {\r\n                '_id': null,\r\n                'amount': {\r\n                    \"$sum\": \"$amount\"\r\n                }\r\n            }\r\n        }\r\n    ]);\r\n    res.locals.year = typeof req.user == 'undefined' ? null : await Expenses.aggregate([\r\n        {\r\n            $match: {\r\n                user: mongoose.Types.ObjectId(req.user.id),\r\n                year: new Date().getFullYear().toString(),\r\n            }\r\n        },\r\n        {\r\n            $group: {\r\n                '_id': null,\r\n                'amount': {\r\n                    $sum: \"$amount\"\r\n                }\r\n            }\r\n        }\r\n    ]);\r\n    res.locals.week = typeof req.user == 'undefined' ? null : await Expenses.aggregate([\r\n        {\r\n            $match: {\r\n                user: mongoose.Types.ObjectId(req.user.id),\r\n                week: new Date().getWeek().toString(),\r\n            }\r\n        },\r\n        {\r\n            $group: {\r\n                '_id': null,\r\n                'amount': {\r\n                    $sum: \"$amount\"\r\n                }\r\n            }\r\n        }\r\n    ]);\r\n    res.locals.month = typeof req.user == 'undefined' ? null : await Expenses.aggregate([\r\n        {\r\n            $match: {\r\n                user: mongoose.Types.ObjectId(req.user.id),\r\n                month: new Date().getMonth().toString(),\r\n            }\r\n        },\r\n        {\r\n            $group: {\r\n                '_id': null,\r\n                'amount': {\r\n                    $sum: \"$amount\"\r\n                }\r\n            }\r\n        }\r\n    ]);\r\n    next();\r\n});\r\n\r\nfunction checkLoggedIn(req, res, next) {\r\n    if (req.isAuthenticated())\r\n        res.redirect('back');\r\n    else {\r\n        next()\r\n    }\r\n}\r\n\r\n// Get index page\r\nrouter.get('/', (req, res, next) => {\r\n    if (req.isAuthenticated()) {\r\n        res.redirect('/home')\r\n    } else {\r\n        res.render('index');\r\n    }\r\n});\r\n\r\nrouter.get('/signup', checkLoggedIn, (req, res, next) => {\r\n    res.render('sign-up');\r\n});\r\n\r\nrouter.get('/faq', (req, res, next) => {\r\n    res.render('faq');\r\n});\r\n\r\nrouter.get('/home', auth, (req, res, next) => {\r\n    //res.send(res.locals.tota)\r\n    res.render('home');\r\n})\r\n\r\nrouter.get('/about', (req, res, next) => {\r\n    res.render('about');\r\n});\r\n\r\nrouter.get('/log-out', (req, res, next) => {\r\n    req.logout();\r\n    return res.redirect('/')\r\n})\r\n\r\nmodule.exports = router;"],"file":"index.js"}